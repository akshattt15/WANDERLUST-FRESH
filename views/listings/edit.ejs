<% layout("/layouts/boilerplate") %>

<div class="row justify-content-center my-4">
  <div class="col-12 col-md-8">
    <h2 class="mb-4 text-center listing-heading">EDIT LISTING</h2>

    <style>
      .listing-heading {
        font-size: 2.5rem;
        font-weight: 700;
        color: #b22222;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
      }
    </style>

    <form method="post" action="/listings/<%= listing._id %>?_method=PUT" 
          enctype="multipart/form-data" class="needs-validation" novalidate>

      <!-- Title & Description -->
      <div class="mb-3">
        <label class="form-label">Title</label>
        <input name="title" type="text" class="form-control" value="<%= listing.title %>" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea name="description" class="form-control" rows="4" required><%= listing.description %></textarea>
      </div>

      <!-- Image -->
      <div class="mb-3">
        <label class="form-label">Image URL</label>
        <input name="imageUrl" type="text" class="form-control" value="<%= listing.image.url || listing.image %>">
      </div>
      <div class="mb-4">
        <label class="form-label">Upload Image</label>
        <input name="imageFile" type="file" class="form-control">
      </div>

      <!-- Price & Country -->
      <div class="row g-3 mb-4">
        <div class="col-md-6">
          <label class="form-label">Price</label>
          <input name="price" type="number" class="form-control" value="<%= listing.price %>" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">Country</label>
          <input name="country" type="text" class="form-control" value="<%= listing.country %>" required>
        </div>
      </div>

      <!-- Location & Map -->
      <div class="mb-4">
        <label class="form-label">Location</label>
        <input name="location" class="form-control mb-2" value="<%= listing.location %>" type="text" required>

        <div id="map" class="w-100 rounded mb-3" style="height: 300px;"></div>

        <!-- Hidden inputs for coordinates -->
        <input type="hidden" id="geometry-lng" name="listing[geometry][coordinates][0]" value="<%= listing.geometry.coordinates[0] %>">
        <input type="hidden" id="geometry-lat" name="listing[geometry][coordinates][1]" value="<%= listing.geometry.coordinates[1] %>">
      </div>

      <!-- Submit -->
      <div class="d-grid">
        <button class="btn btn-dark py-2">UPDATE LISTING</button>
      </div>
    </form>
  </div>
</div>

<!-- Pass Mapbox token & coordinates -->
<script>
  window.mapboxToken = "<%= mapToken %>";
  window.initialCoordinates = <%= JSON.stringify(listing.geometry.coordinates) %>;
</script>
<script src="/js/map2.js"></script>
